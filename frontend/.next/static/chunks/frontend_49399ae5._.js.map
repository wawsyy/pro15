{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/hooks/useEthersSigner.ts"],"sourcesContent":["import { useMemo } from \"react\";\r\nimport { useAccount, usePublicClient, useWalletClient } from \"wagmi\";\r\nimport { BrowserProvider, JsonRpcSigner } from \"ethers\";\r\n\r\nexport function useEthersSigner() {\r\n  const { address, isConnected } = useAccount();\r\n  const { data: walletClient } = useWalletClient();\r\n  const publicClient = usePublicClient();\r\n\r\n  return useMemo(() => {\r\n    if (!isConnected || !walletClient || !address) return undefined;\r\n\r\n    const provider = new BrowserProvider(walletClient as any);\r\n    return provider.getSigner(address) as Promise<JsonRpcSigner>;\r\n  }, [walletClient, address, isConnected]);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAAA;AACA;;;;;AAEO,SAAS;;IACd,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,IAAA,wLAAU;IAC3C,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe;IAC9C,MAAM,eAAe,IAAA,kMAAe;IAEpC,OAAO,IAAA,oLAAO;mCAAC;YACb,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,SAAS,OAAO;YAEtD,MAAM,WAAW,IAAI,0MAAe,CAAC;YACrC,OAAO,SAAS,SAAS,CAAC;QAC5B;kCAAG;QAAC;QAAc;QAAS;KAAY;AACzC;GAXgB;;QACmB,wLAAU;QACZ,kMAAe;QACzB,kMAAe","debugId":null}},
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 572, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/hooks/useZamaInstance.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useAccount, useChainId } from \"wagmi\";\r\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\r\nimport { createFhevmInstance } from \"@/fhevm/internal/fhevm\";\r\n\r\nexport function useZamaInstance() {\r\n  const { address, isConnected } = useAccount();\r\n  const chainId = useChainId();\r\n  const [instance, setInstance] = useState<FhevmInstance | undefined>(undefined);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<Error | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (!isConnected || !address || !chainId) {\r\n      setInstance(undefined);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(undefined);\r\n\r\n    const abortController = new AbortController();\r\n    const mockChains: Record<number, string> = {\r\n      31337: \"http://localhost:8545\", // Hardhat localhost\r\n    };\r\n\r\n    createFhevmInstance({\r\n      signal: abortController.signal,\r\n      provider: window.ethereum as any,\r\n      mockChains: mockChains,\r\n      onStatusChange: (s) => console.log(`[useZamaInstance] status: ${s}`),\r\n    })\r\n      .then((inst) => {\r\n        if (!abortController.signal.aborted) {\r\n          setInstance(inst);\r\n          setIsLoading(false);\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        if (!abortController.signal.aborted) {\r\n          setError(e);\r\n          setIsLoading(false);\r\n        }\r\n      });\r\n\r\n    return () => {\r\n      abortController.abort();\r\n    };\r\n  }, [isConnected, address, chainId]);\r\n\r\n  return { instance, isLoading, error };\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAEA;;;;;AAEO,SAAS;;IACd,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,IAAA,wLAAU;IAC3C,MAAM,UAAU,IAAA,wLAAU;IAC1B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,qLAAQ,EAA4B;IACpE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,qLAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,qLAAQ,EAAoB;IAEtD,IAAA,sLAAS;qCAAC;YACR,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,SAAS;gBACxC,YAAY;gBACZ;YACF;YAEA,aAAa;YACb,SAAS;YAET,MAAM,kBAAkB,IAAI;YAC5B,MAAM,aAAqC;gBACzC,OAAO;YACT;YAEA,IAAA,gKAAmB,EAAC;gBAClB,QAAQ,gBAAgB,MAAM;gBAC9B,UAAU,OAAO,QAAQ;gBACzB,YAAY;gBACZ,cAAc;iDAAE,CAAC,IAAM,QAAQ,GAAG,CAAC,AAAC,6BAA8B,OAAF;;YAClE,GACG,IAAI;6CAAC,CAAC;oBACL,IAAI,CAAC,gBAAgB,MAAM,CAAC,OAAO,EAAE;wBACnC,YAAY;wBACZ,aAAa;oBACf;gBACF;4CACC,KAAK;6CAAC,CAAC;oBACN,IAAI,CAAC,gBAAgB,MAAM,CAAC,OAAO,EAAE;wBACnC,SAAS;wBACT,aAAa;oBACf;gBACF;;YAEF;6CAAO;oBACL,gBAAgB,KAAK;gBACvB;;QACF;oCAAG;QAAC;QAAa;QAAS;KAAQ;IAElC,OAAO;QAAE;QAAU;QAAW;IAAM;AACtC;GA9CgB;;QACmB,wLAAU;QAC3B,wLAAU","debugId":null}},
    {"offset": {"line": 655, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/GenericStringStorage.ts"],"sourcesContent":["export interface GenericStringStorage {\r\n  getItem(key: string): string | Promise<string | null> | null;\r\n  setItem(key: string, value: string): void | Promise<void>;\r\n  removeItem(key: string): void | Promise<void>;\r\n}\r\n\r\nexport class GenericStringInMemoryStorage implements GenericStringStorage {\r\n  #store = new Map<string, string>();\r\n\r\n  getItem(key: string): string | Promise<string | null> | null {\r\n    return this.#store.has(key) ? this.#store.get(key)! : null;\r\n  }\r\n  setItem(key: string, value: string): void | Promise<void> {\r\n    this.#store.set(key, value);\r\n  }\r\n  removeItem(key: string): void | Promise<void> {\r\n    this.#store.delete(key);\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;IAOE;AADK,MAAM;IAGX,QAAQ,GAAW,EAA0C;QAC3D,OAAO,6LAAA,IAAI,EAAC,QAAO,GAAG,CAAC,OAAO,6LAAA,IAAI,EAAC,QAAO,GAAG,CAAC,OAAQ;IACxD;IACA,QAAQ,GAAW,EAAE,KAAa,EAAwB;QACxD,6LAAA,IAAI,EAAC,QAAO,GAAG,CAAC,KAAK;IACvB;IACA,WAAW,GAAW,EAAwB;QAC5C,6LAAA,IAAI,EAAC,QAAO,MAAM,CAAC;IACrB;;QAVA,oMAAA;;mBAAS,IAAI;;;AAWf","debugId":null}},
    {"offset": {"line": 688, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/hooks/useInMemoryStorage.tsx"],"sourcesContent":["import { createContext, ReactNode, useContext, useState } from \"react\";\r\nimport {\r\n  GenericStringInMemoryStorage,\r\n  GenericStringStorage,\r\n} from \"@/fhevm/GenericStringStorage\";\r\n\r\ninterface UseInMemoryStorageState {\r\n  storage: GenericStringStorage;\r\n}\r\n\r\ninterface InMemoryStorageProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nconst InMemoryStorageContext = createContext<\r\n  UseInMemoryStorageState | undefined\r\n>(undefined);\r\n\r\nexport const useInMemoryStorage = () => {\r\n  const context = useContext(InMemoryStorageContext);\r\n  if (!context) {\r\n    throw new Error(\r\n      \"useInMemoryStorage must be used within a InMemoryStorageProvider\"\r\n    );\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const InMemoryStorageProvider: React.FC<\r\n  InMemoryStorageProviderProps\r\n> = ({ children }) => {\r\n  const [storage] = useState<GenericStringStorage>(\r\n    new GenericStringInMemoryStorage()\r\n  );\r\n  return (\r\n    <InMemoryStorageContext.Provider value={{ storage }}>\r\n      {children}\r\n    </InMemoryStorageContext.Provider>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;;;;;AAaA,MAAM,uCAAyB,IAAA,0LAAa,EAE1C;AAEK,MAAM,qBAAqB;;IAChC,MAAM,UAAU,IAAA,uLAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MACR;IAEJ;IACA,OAAO;AACT;GARa;AAUN,MAAM,0BAET;QAAC,EAAE,QAAQ,EAAE;;IACf,MAAM,CAAC,QAAQ,GAAG,IAAA,qLAAQ,EACxB,IAAI,4KAA4B;IAElC,qBACE,yMAAC,uBAAuB,QAAQ;QAAC,OAAO;YAAE;QAAQ;kBAC/C;;;;;;AAGP;IAXa;KAAA","debugId":null}},
    {"offset": {"line": 737, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/abi/EncryptedIdentityAuthAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedIdentityAuthAddresses = { \n  \"11155111\": { address: \"0x9529C86672CDFd1DE83D64c5087B01B0e3A3fcBE\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,iCAAiC;IAC5C,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 763, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/abi/EncryptedIdentityAuthABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedIdentityAuthABI = {\n  \"abi\": [\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getEncryptedIdentity\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"isRegistered\",\n      \"outputs\": [\n        {\n          \"internalType\": \"bool\",\n          \"name\": \"\",\n          \"type\": \"bool\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedIdentity\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"register\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedIdentity\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"verify\",\n      \"outputs\": [\n        {\n          \"internalType\": \"ebool\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,2BAA2B;IACtC,OAAO;QACL;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 874, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number;\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.warn(`Could not load signature! key=${storageKey.key}`);\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;AAAA;;;;;AAQA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;IAGE,kDACA,4CACA,0CACA;AAJF,MAAM;IA4CJ,IAAI,oBAAqC;QACvC,oMAAO,IAAI,EAAC;IACd;IAEA,IAAI,cAA6B;QAC/B,oMAAO,IAAI,EAAC;IACd;IAEA,IAAI,YAAgC;QAClC,oMAAO,IAAI,EAAC;IACd;IAEA,IAAI,MAAc;QAChB,oMAAO,IAAI,EAAC;IACd;IApDA,YACE,QAAuB,EACvB,iBAA2B,EAC3B,WAAmB,EACnB,SAAkB,CAClB;QAVF,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QAQE,IAAI,CAAC,yMAAM,CAAC,SAAS,CAAC,cAAc;YAClC,MAAM,IAAI,UAAU,AAAC,mBAA8B,OAAZ;QACzC;QAEA,MAAM,0BAA0B,AAC9B,kBACA,IAAI;QAEN,MAAM,cAAc,SAAS,YAAY,CACvC,sBAAA,uBAAA,YAAa,yMAAM,CAAC,WAAW,EAC/B,yBACA,GACA;QAGF,IAAI;YACF,MAAM,OAAO,yMAAM,CAAC,gBAAgB,CAAC,IAAI,CACvC,YAAY,MAAM,EAClB;gBAAE,gCAAgC,YAAY,KAAK,CAAC,8BAA8B;YAAC,GACnF,YAAY,OAAO;+MAGhB,oBAAqB;+MACrB,cAAe;+MAEf,MAAO,AAAC,GAAiB,OAAf,aAAY,KAAQ,OAAL;QAChC,EAAE,OAAO,GAAG;YACV,QAAQ,GAAG,CAAC;YACZ,MAAM;QACR;IACF;AAiBF;IAGE,2CACA,2CACA,0CACA,+CACA,6CACA,6CACA,mDACA;AARK,MAAM;IAwBX,IAAW,aAAa;QACtB,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,YAAY;QACrB,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,YAAY;QACrB,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,oBAAoB;QAC7B,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,iBAAiB;QAC1B,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,eAAe;QACxB,oMAAO,IAAI,EAAC;IACd;IAEA,IAAW,cAAc;QACvB,oMAAO,IAAI,EAAC;IACd;IAEA,OAAO,QAAQ,CAAU,EAAqC;QAC5D,IAAI,CAAC,KAAK,OAAO,MAAM,UAAU;YAC/B,OAAO;QACT;QACA,IAAI,CAAC,CAAC,eAAe,KAAK,OAAO,EAAE,SAAS,KAAK,QAAQ,GAAG;YAC1D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,gBAAgB,KAAK,OAAO,EAAE,UAAU,KAAK,QAAQ,GAAG;YAC5D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,eAAe,KAAK,OAAO,EAAE,SAAS,KAAK,QAAQ,GAAG;YAC1D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,OAAO,EAAE,cAAc,KAAK,QAAQ,GAAG;YACpE,OAAO;QACT;QACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,OAAO,EAAE,YAAY,KAAK,QAAQ,GAAG;YAChE,OAAO;QACT;QACA,IAAI,CAAC,CAAC,uBAAuB,KAAK,MAAM,OAAO,CAAC,EAAE,iBAAiB,CAAC,GAAG;YACrE,OAAO;QACT;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,iBAAiB,CAAC,MAAM,EAAE,EAAE,EAAG;YACnD,IAAI,OAAO,EAAE,iBAAiB,CAAC,EAAE,KAAK,UAAU,OAAO;YACvD,IAAI,CAAC,EAAE,iBAAiB,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,OAAO;QACvD;QACA,IACE,CAAC,CACC,iBAAiB,KACjB,OAAO,EAAE,WAAW,KAAK,YACzB,EAAE,WAAW,CAAC,UAAU,CAAC,KAC3B,GACA;YACA,OAAO;QACT;QACA,IAAI,CAAC,CAAC,YAAY,KAAK,OAAO,EAAE,MAAM,KAAK,YAAY,EAAE,MAAM,KAAK,IAAI,GAAG;YACzE,OAAO;QACT;QAEA,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,IAAI,OAAO,EAAE,MAAM,CAAC,MAAM,KAAK,QAAQ,GAAG;YAClE,OAAO;QACT;QACA,IACE,CAAC,CAAC,iBAAiB,EAAE,MAAM,IAAI,OAAO,EAAE,MAAM,CAAC,WAAW,KAAK,QAAQ,GACvE;YACA,OAAO;QACT;QACA,IAAI,CAAC,CAAC,aAAa,EAAE,MAAM,GAAG;YAC5B,OAAO;QACT;QACA,IACE,CAAC,CACC,WAAW,EAAE,MAAM,IACnB,OAAO,EAAE,MAAM,CAAC,KAAK,KAAK,YAC1B,EAAE,MAAM,CAAC,KAAK,KAAK,IACrB,GACA;YACA,OAAO;QACT;QAEA,OAAO;IACT;IAEA,SAAS;QACP,OAAO;YACL,SAAS,+LAAE,IAAI,EAAC;YAChB,UAAU,+LAAE,IAAI,EAAC;YACjB,SAAS,+LAAE,IAAI,EAAC;YAChB,cAAc,+LAAE,IAAI,EAAC;YACrB,YAAY,+LAAE,IAAI,EAAC;YACnB,WAAW,+LAAE,IAAI,EAAC;YAClB,iBAAiB,+LAAE,IAAI,EAAC;YACxB,MAAM,+LAAE,IAAI,EAAC;QACf;IACF;IAEA,OAAO,SAAS,IAAa,EAAE;QAC7B,MAAM,OAAO,OAAO,SAAS,WAAW,KAAK,KAAK,CAAC,QAAQ;QAC3D,OAAO,IAAI,yBAAyB;IACtC;IAEA,OAAO,CAA+B,EAAE;QACtC,OAAO,EAAE,SAAS,kMAAK,IAAI,EAAC;IAC9B;IAEA,UAAmB;QACjB,OACE,kBAAkB,6LAAA,IAAI,EAAC,mBAAkB,6LAAA,IAAI,EAAC,iBAAgB,KAAK,KAAK;IAE5E;IAEA,MAAM,2BACJ,OAA6B,EAC7B,QAAuB,EACvB,aAAsB,EACtB;QACA,IAAI;YACF,MAAM,QAAQ,KAAK,SAAS,CAAC,IAAI;YAEjC,MAAM,aAAa,IAAI,mCACrB,uMACA,IAAI,EAAC,mNACL,IAAI,EAAC,gBACL,6MAAgB,IAAI,EAAC,eAAa;YAEpC,MAAM,QAAQ,OAAO,CAAC,WAAW,GAAG,EAAE;YACtC,QAAQ,GAAG,CACT,AAAC,8BAA4D,OAA/B,6LAAA,IAAI,EAAC,qBAAmB,MAAM;QAEhE,EAAE,UAAM;YACN,QAAQ,KAAK,CACV;QAEL;IACF;IAEA,aAAa,6BACX,OAA6B,EAC7B,QAAuB,EACvB,iBAA2B,EAC3B,WAAmB,EACnB,SAAkB,EACwB;QAC1C,IAAI;YACF,MAAM,aAAa,IAAI,mCACrB,UACA,mBACA,aACA;YAGF,MAAM,SAAS,MAAM,QAAQ,OAAO,CAAC,WAAW,GAAG;YAEnD,IAAI,CAAC,QAAQ;gBACX,QAAQ,IAAI,CAAC,AAAC,iCAA+C,OAAf,WAAW,GAAG;gBAC5D,OAAO;YACT;YAEA,IAAI;gBACF,MAAM,MAAM,yBAAyB,QAAQ,CAAC;gBAC9C,IAAI,CAAC,IAAI,OAAO,IAAI;oBAClB,OAAO;gBACT;gBAEA,OAAO;YACT,EAAE,UAAM;gBACN,OAAO;YACT;QACF,EAAE,UAAM;YACN,QAAQ,KAAK,CACV;YAEH,OAAO;QACT;IACF;IAEA,aAAa,IACX,QAAuB,EACvB,iBAA2B,EAC3B,SAAiB,EACjB,UAAkB,EAClB,MAAqB,EACqB;QAC1C,IAAI;YACF,MAAM,cAAe,MAAM,OAAO,UAAU;YAC5C,MAAM,iBAAiB;YACvB,MAAM,eAAe;YACrB,MAAM,SAAS,SAAS,YAAY,CAClC,WACA,mBACA,gBACA;YAEF,MAAM,YAAY,MAAM,OAAO,aAAa,CAC1C,OAAO,MAAM,EACb;gBAAE,gCAAgC,OAAO,KAAK,CAAC,8BAA8B;YAAC,GAC9E,OAAO,OAAO;YAEhB,OAAO,IAAI,yBAAyB;gBAClC;gBACA;gBACA,mBAAmB;gBACnB;gBACA;gBACA;gBACA,QAAQ;gBACR;YACF;QACF,EAAE,UAAM;YACN,OAAO;QACT;IACF;IAEA,aAAa,WACX,QAAuB,EACvB,iBAA2B,EAC3B,MAAqB,EACrB,OAA6B,EAC7B,OAAmD,EACT;QAC1C,MAAM,cAAe,MAAM,OAAO,UAAU;QAE5C,MAAM,SACJ,MAAM,yBAAyB,4BAA4B,CACzD,SACA,UACA,mBACA,aACA,oBAAA,8BAAA,QAAS,SAAS;QAGtB,IAAI,QAAQ;YACV,OAAO;QACT;QAEA,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,oBAAA,qBAAA,UAAW,SAAS,eAAe;QAErE,MAAM,MAAM,MAAM,yBAAyB,GAAG,CAC5C,UACA,mBACA,WACA,YACA;QAGF,IAAI,CAAC,KAAK;YACR,OAAO;QACT;QAEA,MAAM,IAAI,0BAA0B,CAClC,SACA,UACA,QAAQ,oBAAA,8BAAA,QAAS,SAAS;QAG5B,OAAO;IACT;IAtRA,YAAoB,UAAwC,CAAE;QAT9D,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QACA,oMAAA;;mBAAA,KAAA;;QAGE,IAAI,CAAC,yBAAyB,OAAO,CAAC,aAAa;YACjD,MAAM,IAAI,UAAU;QACtB;2MACK,aAAa,WAAW,SAAS;2MACjC,aAAc,WAAW,UAAU;2MACnC,YAAa,WAAW,SAAS;2MACjC,iBAAkB,WAAW,cAAc;2MAC3C,eAAgB,WAAW,YAAY;2MACvC,eAAe,WAAW,WAAW;2MACrC,qBAAqB,WAAW,iBAAiB;2MACjD,SAAU,WAAW,MAAM;IAClC;AA2QF","debugId":null}},
    {"offset": {"line": 1151, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo15/pro15/frontend/components/IdentityAuth.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useCallback, useEffect } from \"react\";\r\nimport { useAccount, useChainId, usePublicClient } from \"wagmi\";\r\nimport { ethers } from \"ethers\";\r\nimport { useEthersSigner } from \"@/hooks/useEthersSigner\";\r\nimport { useZamaInstance } from \"@/hooks/useZamaInstance\";\r\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\r\nimport { EncryptedIdentityAuthAddresses } from \"@/abi/EncryptedIdentityAuthAddresses\";\r\nimport { EncryptedIdentityAuthABI } from \"@/abi/EncryptedIdentityAuthABI\";\r\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\r\n\r\nexport const IdentityAuth = () => {\r\n  const { address, isConnected } = useAccount();\r\n  const chainId = useChainId();\r\n  const publicClient = usePublicClient();\r\n  const ethersSignerPromise = useEthersSigner();\r\n  const { instance: zama, isLoading: zamaLoading } = useZamaInstance();\r\n  const { storage } = useInMemoryStorage();\r\n\r\n  const [userIdentity, setUserIdentity] = useState<string>(\"\");\r\n  const [isRegistered, setIsRegistered] = useState<boolean>(false);\r\n  const [isRegistering, setIsRegistering] = useState<boolean>(false);\r\n  const [isVerifying, setIsVerifying] = useState<boolean>(false);\r\n  const [verificationResult, setVerificationResult] = useState<boolean | null>(null);\r\n  const [message, setMessage] = useState<string>(\"\");\r\n  const [contractAddress, setContractAddress] = useState<string | undefined>(undefined);\r\n  const [isMounted, setIsMounted] = useState<boolean>(false);\r\n  const [rpcError, setRpcError] = useState<string | null>(null);\r\n  \r\n  // Encryption/Decryption process visibility\r\n  const [showProcessDetails, setShowProcessDetails] = useState<boolean>(false);\r\n  const [encryptedHandle, setEncryptedHandle] = useState<string | null>(null);\r\n  const [encryptedResultHandle, setEncryptedResultHandle] = useState<string | null>(null);\r\n  const [decryptedResult, setDecryptedResult] = useState<boolean | null>(null);\r\n  const [currentStep, setCurrentStep] = useState<string>(\"\");\r\n\r\n  // Prevent hydration mismatch\r\n  useEffect(() => {\r\n    setIsMounted(true);\r\n  }, []);\r\n\r\n  // Get contract address based on current chain\r\n  useEffect(() => {\r\n    if (chainId && isMounted) {\r\n      const entry = EncryptedIdentityAuthAddresses[chainId.toString() as keyof typeof EncryptedIdentityAuthAddresses];\r\n      if (entry && \"address\" in entry && entry.address !== ethers.ZeroAddress) {\r\n        setContractAddress(entry.address);\r\n      } else {\r\n        setContractAddress(undefined);\r\n      }\r\n    } else if (!chainId && isMounted) {\r\n      setContractAddress(undefined);\r\n    }\r\n  }, [chainId, isMounted]);\r\n\r\n  // Check registration status\r\n  const checkRegistration = useCallback(async () => {\r\n    if (!contractAddress || !address || !publicClient) return;\r\n\r\n    try {\r\n      setRpcError(null);\r\n      const registered = await publicClient.readContract({\r\n        address: contractAddress as `0x${string}`,\r\n        abi: EncryptedIdentityAuthABI.abi,\r\n        functionName: \"isRegistered\",\r\n        args: [address as `0x${string}`],\r\n      });\r\n      setIsRegistered(registered as boolean);\r\n    } catch (error: any) {\r\n      setIsRegistered(false);\r\n      \r\n      // Check if it's a network/RPC error\r\n      const errorMessage = error?.message || \"\";\r\n      const isNetworkError = \r\n        errorMessage.includes(\"Failed to fetch\") || \r\n        errorMessage.includes(\"fetch failed\") ||\r\n        errorMessage.includes(\"ECONNREFUSED\") ||\r\n        error?.code === \"NETWORK_ERROR\";\r\n      \r\n      if (isNetworkError) {\r\n        if (chainId === 31337) {\r\n          setRpcError(\"Hardhat node is not running. Please start it with: npx hardhat node\");\r\n        } else {\r\n          setRpcError(\"Failed to connect to RPC. Please check your network connection.\");\r\n        }\r\n        // Don't log network errors to console as they're expected when node is not running\r\n      } else {\r\n        // Only log non-network errors\r\n        console.error(\"Error checking registration:\", error);\r\n      }\r\n    }\r\n  }, [contractAddress, address, publicClient, chainId]);\r\n\r\n  useEffect(() => {\r\n    if (isConnected && contractAddress) {\r\n      checkRegistration();\r\n    }\r\n  }, [isConnected, contractAddress, checkRegistration]);\r\n\r\n  const handleRegister = useCallback(async () => {\r\n    if (!userIdentity || !zama || !ethersSignerPromise || !contractAddress || !address) {\r\n      setMessage(\"Please connect wallet and enter identity\");\r\n      return;\r\n    }\r\n\r\n    const identityNum = parseInt(userIdentity);\r\n    if (isNaN(identityNum)) {\r\n      setMessage(\"Identity must be a number\");\r\n      return;\r\n    }\r\n\r\n    setIsRegistering(true);\r\n    setCurrentStep(\"encrypting\");\r\n    setMessage(\"Encrypting identity...\");\r\n    setEncryptedHandle(null);\r\n    setShowProcessDetails(true);\r\n\r\n    try {\r\n      const signer = await ethersSignerPromise;\r\n      const contract = new ethers.Contract(\r\n        contractAddress,\r\n        EncryptedIdentityAuthABI.abi,\r\n        signer\r\n      );\r\n\r\n      // Encrypt identity\r\n      setCurrentStep(\"encrypting\");\r\n      setMessage(`Encrypting identity \"${identityNum}\" locally...`);\r\n      const input = zama.createEncryptedInput(contractAddress, address);\r\n      input.add32(identityNum);\r\n      const encrypted = await input.encrypt();\r\n      \r\n      // Store encrypted handle for display\r\n      setEncryptedHandle(encrypted.handles[0]);\r\n      setMessage(` Encrypted! Handle: ${encrypted.handles[0].slice(0, 20)}...`);\r\n\r\n      setCurrentStep(\"registering\");\r\n      setMessage(\"Sending encrypted identity to blockchain...\");\r\n      const tx = await contract.register(encrypted.handles[0], encrypted.inputProof);\r\n      setMessage(`Transaction sent: ${tx.hash}. Waiting for confirmation...`);\r\n\r\n      await tx.wait();\r\n      setCurrentStep(\"complete\");\r\n      setMessage(\" Registration successful! Your encrypted identity is now stored on-chain.\");\r\n      setIsRegistered(true);\r\n    } catch (error: any) {\r\n      setMessage(`Registration failed: ${error.message}`);\r\n    } finally {\r\n      setIsRegistering(false);\r\n    }\r\n  }, [userIdentity, zama, ethersSignerPromise, contractAddress, address]);\r\n\r\n  const handleVerify = useCallback(async () => {\r\n    if (!userIdentity || !zama || !ethersSignerPromise || !contractAddress || !address) {\r\n      setMessage(\"Please connect wallet and enter identity\");\r\n      return;\r\n    }\r\n\r\n    const identityNum = parseInt(userIdentity);\r\n    if (isNaN(identityNum)) {\r\n      setMessage(\"Identity must be a number\");\r\n      return;\r\n    }\r\n\r\n    setIsVerifying(true);\r\n    setCurrentStep(\"encrypting\");\r\n    setMessage(\"Encrypting identity for verification...\");\r\n    setEncryptedHandle(null);\r\n    setEncryptedResultHandle(null);\r\n    setDecryptedResult(null);\r\n    setShowProcessDetails(true);\r\n\r\n    try {\r\n      const signer = await ethersSignerPromise;\r\n      const contract = new ethers.Contract(\r\n        contractAddress,\r\n        EncryptedIdentityAuthABI.abi,\r\n        signer\r\n      );\r\n\r\n      // Step 1: Encrypt identity\r\n      setCurrentStep(\"encrypting\");\r\n      setMessage(`Step 1/3: Encrypting identity \"${identityNum}\" locally...`);\r\n      const input = zama.createEncryptedInput(contractAddress, address);\r\n      input.add32(identityNum);\r\n      const encrypted = await input.encrypt();\r\n      setEncryptedHandle(encrypted.handles[0]);\r\n      setMessage(` Step 1 Complete: Encrypted! Handle: ${encrypted.handles[0].slice(0, 20)}...`);\r\n\r\n      // Step 2: Verify on-chain (FHE comparison)\r\n      setCurrentStep(\"verifying\");\r\n      setMessage(\"Step 2/3: Comparing encrypted identities on-chain (FHE operation)...\");\r\n      \r\n      // Call verify function - it returns an ebool (handle string)\r\n      // In ethers.js, non-view functions that return values will return the value after transaction confirmation\r\n      const verifyResult = await contract.verify(encrypted.handles[0], encrypted.inputProof);\r\n      \r\n      // Extract the handle string from the result\r\n      // The result should be a string (handle), but handle different return types\r\n      let encryptedResult: string;\r\n      if (typeof verifyResult === 'string') {\r\n        encryptedResult = verifyResult;\r\n      } else if (verifyResult && typeof verifyResult === 'object') {\r\n        // If it's an object, it might be a transaction response\r\n        // Wait for it and try to get the return value\r\n        if ('wait' in verifyResult) {\r\n          const receipt = await verifyResult.wait();\r\n          // Try to extract return value from receipt\r\n          // For FHE contracts, the return value is usually the handle string\r\n          // We might need to decode it from logs or use a different approach\r\n          // For now, let's use staticCall to get the return value without sending a transaction\r\n          const staticResult = await contract.verify.staticCall(encrypted.handles[0], encrypted.inputProof);\r\n          encryptedResult = typeof staticResult === 'string' ? staticResult : String(staticResult);\r\n        } else {\r\n          encryptedResult = String(verifyResult);\r\n        }\r\n      } else {\r\n        encryptedResult = String(verifyResult);\r\n      }\r\n      \r\n      setEncryptedResultHandle(encryptedResult);\r\n      setMessage(` Step 2 Complete: FHE comparison done! Encrypted result handle: ${encryptedResult.slice(0, 20)}...`);\r\n\r\n      // Step 3: Decrypt result\r\n      setCurrentStep(\"decrypting\");\r\n      setMessage(\"Step 3/3: Decrypting verification result locally...\");\r\n      \r\n      // Get decryption signature\r\n      const sig = await FhevmDecryptionSignature.loadOrSign(\r\n        zama,\r\n        [contractAddress],\r\n        signer,\r\n        storage\r\n      );\r\n\r\n      if (!sig) {\r\n        setMessage(\"Failed to get decryption signature\");\r\n        return;\r\n      }\r\n\r\n      // Decrypt result - ensure encryptedResult is a string\r\n      const resultHandle = typeof encryptedResult === 'string' ? encryptedResult : String(encryptedResult);\r\n      const result = await zama.userDecrypt(\r\n        [{ handle: resultHandle, contractAddress }],\r\n        sig.privateKey,\r\n        sig.publicKey,\r\n        sig.signature,\r\n        sig.contractAddresses,\r\n        sig.userAddress,\r\n        sig.startTimestamp,\r\n        sig.durationDays\r\n      );\r\n\r\n      const isValid = result[resultHandle] === true;\r\n      setDecryptedResult(isValid);\r\n      setVerificationResult(isValid);\r\n      setCurrentStep(\"complete\");\r\n      setMessage(isValid \r\n        ? \" Step 3 Complete: Decrypted result = true. Verification successful! Identity matches.\" \r\n        : \" Step 3 Complete: Decrypted result = false. Verification failed. Identity does not match.\");\r\n    } catch (error: any) {\r\n      setMessage(`Verification failed: ${error.message}`);\r\n      setVerificationResult(null);\r\n    } finally {\r\n      setIsVerifying(false);\r\n    }\r\n  }, [userIdentity, zama, ethersSignerPromise, contractAddress, address, storage]);\r\n\r\n  // Prevent hydration mismatch - show loading state until mounted\r\n  if (!isMounted) {\r\n    return (\r\n      <div className=\"mx-auto mt-20 text-center\">\r\n        <div className=\"bg-white rounded-xl shadow-lg p-8 max-w-md\">\r\n          <h2 className=\"text-2xl font-bold mb-4 text-gray-800\">Loading...</h2>\r\n          <p className=\"text-gray-600\">Initializing application...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isConnected) {\r\n    return (\r\n      <div className=\"mx-auto mt-20 text-center\">\r\n        <div className=\"bg-white rounded-xl shadow-lg p-8 max-w-md\">\r\n          <h2 className=\"text-2xl font-bold mb-4 text-gray-800\">Connect Your Wallet</h2>\r\n          <p className=\"text-gray-600\">Please connect your wallet using the button in the top right corner to get started.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!contractAddress) {\r\n    const chainName = chainId === 31337 ? \"Hardhat Local\" : chainId === 11155111 ? \"Sepolia Testnet\" : `Chain ID ${chainId || \"unknown\"}`;\r\n    return (\r\n      <div className=\"mx-auto mt-20 text-center\">\r\n        <div className=\"bg-white rounded-xl shadow-lg p-8 max-w-md\">\r\n          <h2 className=\"text-2xl font-bold mb-4 text-orange-600\">Contract Not Deployed</h2>\r\n          <p className=\"text-gray-600 mb-4\">\r\n            The contract is not deployed on {chainName}. Please deploy it first or switch to the correct network.\r\n          </p>\r\n          <div className=\"text-sm text-gray-500 space-y-1\">\r\n            <p><strong>Supported Networks:</strong></p>\r\n            <p> Hardhat Local (Chain ID: 31337) - For local development</p>\r\n            <p> Sepolia Testnet (Chain ID: 11155111) - For testing</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const buttonClass =\r\n    \"inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-3 font-semibold text-white shadow-lg \" +\r\n    \"transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl active:scale-95 \" +\r\n    \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 \" +\r\n    \"disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed\";\r\n\r\n  return (\r\n    <div className=\"grid w-full gap-6\">\r\n      <div className=\"col-span-full mx-auto max-w-4xl\">\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 border border-gray-100\">\r\n          <h2 className=\"text-3xl font-bold mb-6 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\r\n            Encrypted Identity Authentication\r\n          </h2>\r\n\r\n          {rpcError && (\r\n            <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n              <div className=\"flex items-start\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-3 flex-1\">\r\n                  <h3 className=\"text-sm font-medium text-red-800\">RPC Connection Error</h3>\r\n                  <div className=\"mt-2 text-sm text-red-700\">\r\n                    <p>{rpcError}</p>\r\n                    {chainId === 31337 && (\r\n                      <div className=\"mt-3 p-3 bg-red-100 rounded-md\">\r\n                        <p className=\"font-semibold mb-1\">To start Hardhat node:</p>\r\n                        <code className=\"text-xs block bg-white p-2 rounded border border-red-200\">\r\n                          cd pro15 && npx hardhat node\r\n                        </code>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"ml-auto pl-3\">\r\n                  <button\r\n                    onClick={() => setRpcError(null)}\r\n                    className=\"text-red-400 hover:text-red-600\"\r\n                  >\r\n                    <svg className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                      <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"space-y-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Your Identity (Number)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                value={userIdentity}\r\n                onChange={(e) => setUserIdentity(e.target.value)}\r\n                placeholder=\"Enter your identity number (e.g., 12345)\"\r\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                disabled={isRegistering || isVerifying}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\r\n              <p className=\"text-sm text-blue-800\">\r\n                <strong>Status:</strong> {isRegistered ? (\r\n                  <span className=\"text-green-600\"> Registered</span>\r\n                ) : (\r\n                  <span className=\"text-orange-600\">Not Registered</span>\r\n                )}\r\n              </p>\r\n            </div>\r\n\r\n            {/* Encryption Section */}\r\n            <div className=\"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-6 border border-purple-200\">\r\n              <h3 className=\"text-lg font-semibold text-purple-900 mb-4\"> Encryption & Registration</h3>\r\n              <p className=\"text-sm text-gray-600 mb-4\">\r\n                Encrypt your identity locally and register it on the blockchain.\r\n              </p>\r\n              <button\r\n                className={buttonClass}\r\n                onClick={handleRegister}\r\n                disabled={!userIdentity || isRegistering || isVerifying || zamaLoading || isRegistered}\r\n              >\r\n                {isRegistering ? \"Encrypting & Registering...\" : \" Encrypt & Register Identity\"}\r\n              </button>\r\n              {isRegistered && (\r\n                <p className=\"text-xs text-green-600 mt-2\"> Identity already registered</p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Decryption Section */}\r\n            {isRegistered && (\r\n              <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200\">\r\n                <h3 className=\"text-lg font-semibold text-green-900 mb-4\"> Verification & Decryption</h3>\r\n                <p className=\"text-sm text-gray-600 mb-4\">\r\n                  Verify your identity by encrypting it, comparing on-chain, and decrypting the result.\r\n                </p>\r\n                <button\r\n                  className=\"inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 hover:from-green-700 hover:to-emerald-700 hover:shadow-xl active:scale-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed\"\r\n                  onClick={handleVerify}\r\n                  disabled={!userIdentity || isRegistering || isVerifying || zamaLoading}\r\n                >\r\n                  {isVerifying ? \"Verifying & Decrypting...\" : \" Verify & Decrypt Result\"}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* Encryption/Decryption Process Details - Hidden */}\r\n            {false && (\r\n              <div className=\"bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg p-6 border border-purple-200\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <h3 className=\"text-lg font-semibold text-purple-900\"> Encryption/Decryption Process</h3>\r\n                  <button\r\n                    onClick={() => setShowProcessDetails(false)}\r\n                    className=\"text-purple-400 hover:text-purple-600\"\r\n                  >\r\n                    <svg className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                      <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  {/* Plaintext Identity */}\r\n                  <div className=\"bg-white rounded-lg p-4 border border-purple-100\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                      <span className=\"text-sm font-semibold text-purple-700\">1 Plaintext Identity</span>\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-600 font-mono bg-gray-50 p-2 rounded\">\r\n                      {userIdentity || \"N/A\"}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">Your original identity number</p>\r\n                  </div>\r\n\r\n                  {/* Encrypted Handle */}\r\n                  {encryptedHandle && (\r\n                    <div className=\"bg-white rounded-lg p-4 border border-purple-100\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <span className=\"text-sm font-semibold text-purple-700\">2 Encrypted Identity (Handle)</span>\r\n                        <span className=\"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded\">Encrypted Locally</span>\r\n                      </div>\r\n                      <p className=\"text-sm text-gray-600 font-mono bg-gray-50 p-2 rounded break-all\">\r\n                        {typeof encryptedHandle === 'string' ? encryptedHandle : String(encryptedHandle)}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Your identity encrypted using FHE, stored on-chain</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Encrypted Result Handle (from verification) */}\r\n                  {encryptedResultHandle && (\r\n                    <div className=\"bg-white rounded-lg p-4 border border-purple-100\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <span className=\"text-sm font-semibold text-purple-700\">3 Encrypted Comparison Result</span>\r\n                        <span className=\"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded\">FHE Operation</span>\r\n                      </div>\r\n                      <p className=\"text-sm text-gray-600 font-mono bg-gray-50 p-2 rounded break-all\">\r\n                        {typeof encryptedResultHandle === 'string' ? encryptedResultHandle : String(encryptedResultHandle)}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">Result of encrypted comparison (still encrypted)</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Decrypted Result */}\r\n                  {decryptedResult !== null && (\r\n                    <div className=\"bg-white rounded-lg p-4 border border-purple-100\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <span className=\"text-sm font-semibold text-purple-700\">4 Decrypted Result</span>\r\n                        <span className={`text-xs px-2 py-1 rounded ${\r\n                          decryptedResult \r\n                            ? \"bg-green-100 text-green-700\" \r\n                            : \"bg-red-100 text-red-700\"\r\n                        }`}>\r\n                          Decrypted Locally\r\n                        </span>\r\n                      </div>\r\n                      <p className={`text-lg font-bold font-mono p-2 rounded ${\r\n                        decryptedResult \r\n                          ? \"bg-green-50 text-green-700\" \r\n                          : \"bg-red-50 text-red-700\"\r\n                      }`}>\r\n                        {decryptedResult ? \"true\" : \"false\"}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">\r\n                        Final decrypted result: {decryptedResult ? \"Identity matches!\" : \"Identity does not match\"}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Current Step Indicator */}\r\n                  {currentStep && currentStep !== \"complete\" && (\r\n                    <div className=\"bg-blue-50 rounded-lg p-3 border border-blue-200\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\r\n                        <p className=\"text-sm text-blue-800 font-medium\">\r\n                          Current Step: {currentStep === \"encrypting\" ? \"Encrypting...\" : \r\n                                        currentStep === \"verifying\" ? \"Verifying on-chain...\" : \r\n                                        currentStep === \"decrypting\" ? \"Decrypting...\" : currentStep}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {verificationResult !== null && (\r\n              <div className={`rounded-lg p-4 ${\r\n                verificationResult\r\n                  ? \"bg-green-50 border border-green-200\"\r\n                  : \"bg-red-50 border border-red-200\"\r\n              }`}>\r\n                <p className={`font-semibold ${\r\n                  verificationResult ? \"text-green-800\" : \"text-red-800\"\r\n                }`}>\r\n                  {verificationResult\r\n                    ? \" Verification Successful: Identity matches!\"\r\n                    : \" Verification Failed: Identity does not match\"}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {message && (\r\n              <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\r\n                <p className=\"text-sm text-gray-700\">{message}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Network Info - Hidden */}\r\n            {false && (\r\n              <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\r\n                <p className=\"text-xs text-gray-600\">\r\n                  <strong>Network:</strong> {chainId === 31337 ? \"Hardhat Local\" : chainId === 11155111 ? \"Sepolia Testnet\" : `Chain ID ${chainId}`}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600 mt-1\">\r\n                  <strong>Contract Address:</strong> {contractAddress}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600 mt-1\">\r\n                  <strong>Your Address:</strong> {address}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}